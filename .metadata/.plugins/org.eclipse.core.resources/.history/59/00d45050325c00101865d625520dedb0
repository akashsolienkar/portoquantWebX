<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Portfolio Report</title>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: 40px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        th, td {
            border: 1px solid #bdc3c7;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #ecf0f1;
        }
        .section {
            margin-top: 40px;
        }
        .chart {
            text-align: center;
            margin-top: 20px;
        }
        .footer {
            font-size: 12px;
            color: #888;
            margin-top: 60px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1 th:text="'Portfolio Report: ' + ${report.portfolioName}"></h1>
    <p><strong>User:</strong> <span th:text="${report.username}"></span></p>
    <p><strong>Email:</strong> <span th:text="${report.email}"></span></p>
    <p><strong>Total Portfolio Value:</strong> 
        <span th:text="${@formatUtils.formatDecimal(report.totalPortfolioValue)} + ' USD'"></span>
    </p>

    <div class="section">
        <h2>Assets Overview</h2>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Weight (%)</th>
                    <th>Value (USD)</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="asset : ${report.assets}">
                    <td th:text="${asset.name}"></td>
                    <td th:text="${asset.type}"></td>
                    <td th:text="${@formatUtils.formatPercentage(asset.weight)}"></td>
                    <td th:text="${@formatUtils.formatDecimal(asset.value)}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Simulation Summary</h2>
        <table>
            <tbody>
                <tr>
                    <th>Value at Risk (VaR)</th>
                    <td th:text="${@formatUtils.formatDecimal(report.latestSimulation.valueAtRisk)} + ' USD'"></td>
                </tr>
                <tr>
                    <th>Expected Shortfall</th>
                    <td th:text="${@formatUtils.formatDecimal(report.latestSimulation.expectedShortfall)} + ' USD'"></td>
                </tr>
                <tr>
                    <th>Volatility</th>
                    <td th:text="${@formatUtils.formatPercentage(report.latestSimulation.volatilityPercent)}"></td>
                </tr>
                <tr>
                    <th>Mean Return</th>
                    <td th:text="${@formatUtils.formatPercentage(report.latestSimulation.meanReturn)}"></td>
                </tr>
                <tr>
                    <th>Final Portfolio Value</th>
                    <td th:text="${@formatUtils.formatDecimal(report.latestSimulation.finalPortfolioValue)} + ' USD'"></td>
                </tr>
                <tr>
                    <th>Bankruptcy Probability</th>
                    <td th:text="${@formatUtils.formatPercentage(report.latestSimulation.bankruptcyProbability)}"></td>
                </tr>
                <tr>
                    <th>Simulations Run</th>
                    <td th:text="${report.latestSimulation.numberOfSimulations}"></td>
                </tr>
                <tr>
                    <th>Simulation Date</th>
                    <td th:text="${report.latestSimulation.simulationDate}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section chart">
        <h2>Asset Allocation</h2>
        <img th:src="@{'data:image/png;base64,' + ${report.pieChartData.base64Image}}" 
             alt="Asset Distribution Chart" width="400"/>
    </div>

    <div class="footer">
        <p>Generated by PortoQuant &copy; 2025</p>
    </div>

</body>
</html>
